<div>
  <h2>{% trans %}Most viewed datasets{% endtrans %}</h2> 
    {% if data['table'] %}
    <table class="table table-condensed table-bordered table-striped">
      <tr>
        <th>{% trans %}Dataset{% endtrans %}</th>
        <th>{% trans %}Total views{% endtrans %}</th>
        <th>{% trans %}Initial entrance{% endtrans %}</th>
        <th>{% trans %}Entrances of total views{% endtrans %}</th>
        <th>{% trans %}Downloads{% endtrans %}</th>
      </tr>
      {% for toppackage in data['top'] %}
        <tr>
          <td>{{ h.link_to(toppackage.package_name, h.url_for(controller='package', action='read', id=toppackage.package_id)) }}</td>
          <td>{{ toppackage.visits }}</td>
          <td>{{ toppackage.entrances }}</td>
          {% set percent = 0 %}
          {% if toppackage.visits != 0 %}{% set percent = ((toppackage.entrances / toppackage.visits) * 100)|round(1, 'floor') %}{% endif %}
          {% set percent_class = 'color_danger' %}
          {% if percent > 25 %}
            {% set percent_class = 'color_warning' %}
              {% if percent > 50 %}
                {% set percent_class = 'color_info' %}
                {% if percent > 75 %}
                  {% set percent_class = 'color_success' %}
                {% endif %}
              {% endif %}
          {% endif %}
          <td class="{{ percent_class }}">{{ percent }}%</td>
          <td>{{ toppackage.downloads }}</td>
        </tr>
      {% endfor %}
    </table>
    {% else %}
      <p>{% trans %}No analytics found for most downloaded datasets.{% endtrans %}</p>
    {% endif %}

 </div>


