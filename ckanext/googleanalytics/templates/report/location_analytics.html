{% resource "ytp_dataset_js/d3.js" %}
{% resource "ckanext-googleanalytics_js/chart-doughnut.js" %}

<script>
  var chartData = {
    finland_vs_world_month: [
      {% for row in table['finland_vs_world_month'] %}
        {
          value: {{ row.visits }},
          label: '{{ row.location }}'
        },
      {% endfor %}
    ],
    finland_vs_world_all: [
      {% for row in table['finland_vs_world_all'] %}
        {
          value: {{ row.visits }},
          label: '{{ row.location }}'
        },
      {% endfor %}
    ],
  }
</script>

<div class="report-chart-row">
  <div data-module="chartData-doughnut"
    data-module-field="finland_vs_world_month"
    data-module-title="{% trans %}Sessions past month{% endtrans %}"
    data-module-legend="true"
    data-module-width="100"
    data-module-height="100"
    id="locationChartLegend"
    class="report-pie-chart flex-1">
  </div>
  <div data-module="chartData-doughnut"
    data-module-field="finland_vs_world_month"
    data-module-title="{% trans %}Sessions past month{% endtrans %}"
    data-module-chart="true"
    id="locationChartMonth"
    class="report-pie-chart flex-2">
  </div>
  <div data-module="chartData-doughnut"
    data-module-field="finland_vs_world_all"
    data-module-title="{% trans %}Sessions total{% endtrans %}"
    data-module-chart="true"
    id="locationChartAll"
    class="report-pie-chart flex-2">
  </div>
</div>
<hr class="page-break">
<div>
  <h2>{% trans %}Audience locations{% endtrans %}</h2> 
  {% if data['table'] %}
    {% if table['top_locations'] %}
      <table class="table table-condensed table-bordered table-striped">
        <tr>
          <th>{% trans %}Countries{% endtrans %}</th>
          <th>{% trans %}Sessions (since recording started){% endtrans %}</th>
        </tr>
        {% for toplocation in table['top_locations'] %}
          <tr>
            <td>{{ toplocation.location_name }}</td>
            <td>{{ toplocation.total_visits }}</td>
          </tr>
        {% endfor %}
      </table>
    {% endif %}
  {% else %}
    <p>{% trans %}No statistics found for audience locations.{% endtrans %}</p>
  {% endif %}
</div>