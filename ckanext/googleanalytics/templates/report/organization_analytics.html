<div class="module-content">
  <h2>{% trans %}Organizations with most viewed datasets{% endtrans %}</h2> 
    {% if data['table'] %}
      <table class="table table-condensed table-bordered table-striped">
      <tr>
        <th>{% trans %}Dataset{% endtrans %}</th>
        <th>{% trans %}Total views{% endtrans %}</th>
        <th>{% trans %}Initial entrance{% endtrans %}</th>
        <th>{% trans %}Entrances of total views{% endtrans %}</th>
        <th>{% trans %}Downloads{% endtrans %}</th>
      </tr>
        {% for toppackage in table %}
          <tr>
            <td>{{ h.link_to(toppackage.organization_name, h.url_for(controller='organization', action='read', id=toppackage.organization_name)) }}</td>
            <td>{{ toppackage.total_visits }}</td>
            <td>{{ toppackage.total_downloads }}</td>
            <td>{{ toppackage.total_entrances }}</td>
            
            {% set percent = 0 %}
            {% if toppackage.visits != 0 %}{% set percent = ((toppackage.total_entrances / toppackage.total_visits) * 100)|round(1, 'floor') %}{% endif %}
            {% set percent_class = 'color_danger' %}
            {% if percent > 25 %}
              {% set percent_class = 'color_warning' %}
                {% if percent > 50 %}
                  {% set percent_class = 'color_info' %}
                  {% if percent > 75 %}
                    {% set percent_class = 'color_success' %}
                  {% endif %}
                {% endif %}
            {% endif %}
            <td class="{{ percent_class }}">{{ percent }}%</td>
          </tr>
        {% endfor %}
      </table>
    {% else %}
      <p>{% trans %}No analytics found for organizations with most visited datasets.{% endtrans %}</p>
    {% endif %}

 </div>
